{% extends "base.html" %}

{% block content %}

<div style="max-width: 800px; margin: 0 auto;">

    <div class="card result-hero">
        <h2 style="color: var(--text-light); font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;">
            Resultado Final
        </h2>

        <div class="score-circle">
            {{ quiz.score }}<span style="font-size: 2.5rem; color: #94a3b8; font-weight: 400;">/{{ quiz.n }}</span>
        </div>

        {% set percent = ((quiz.score / quiz.n) * 100) | round | int %}
        <div style="margin-bottom: 15px;">
            <div style="font-size: 1.5rem; font-weight: 700; color: {{ '#10b981' if percent >= 70 else '#f59e0b' if percent >= 40 else '#ef4444' }}; margin-bottom: 5px;">
                {{ percent }}% de Aproveitamento
            </div>
            
            <div class="progress-bar-bg" style="height: 12px; max-width: 300px; margin: 0 auto;">
                <div class="progress-bar-fill" style="width: {{ percent }}%; background: {{ '#10b981' if percent >= 70 else '#f59e0b' if percent >= 40 else '#ef4444' }};"></div>
            </div>
        </div>

        <p style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 25px;">
            Área: <strong>{{ quiz.area }}</strong> &bull; Modo: <strong>{{ quiz.mode|capitalize }}</strong>
        </p>

        {% if per_area and per_area|length > 1 %}
            <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 30px;">
                {% for area, v in per_area.items() %}
                    <span class="badge badge-diff" style="font-size: 0.85rem; padding: 6px 12px;">
                        {{ area }}: <strong style="color: var(--primary);">{{ v.correct }}/{{ v.total }}</strong>
                    </span>
                {% endfor %}
            </div>
        {% endif %}

        <div class="result-actions">
            <a href="{{ url_for('index') }}" class="btn-outline">
                <i class="fas fa-home"></i> Menu Inicial
            </a>

            <a href="{{ url_for('reset') }}" class="btn-primary" style="width: auto;">
                <i class="fas fa-redo"></i> Jogar Novamente
            </a>
            
            {% if session.get("wrong_ids") %}
                <a href="{{ url_for('review') }}" class="btn-primary" style="background: var(--accent); width: auto;">
                    <i class="fas fa-book-reader"></i> Revisar Erros
                </a>
            {% endif %}
        </div>
    </div>

    <h3 style="margin: 30px 0 20px; color: var(--primary); border-left: 5px solid var(--gold); padding-left: 15px;">
        Gabarito Comentado
    </h3>

    <div class="review-list">
        {% for d in details %}
            <div class="card history-card {{ 'hist-correct' if d.is_correct else 'hist-wrong' }}">
                
                <div class="hist-header">
                    <span class="badge badge-area">{{ d.area }}</span>
                    
                    {% if d.is_correct %}
                        <span class="status-badge st-ok"><i class="fas fa-check"></i> ACERTOU</span>
                    {% else %}
                        <span class="status-badge st-err"><i class="fas fa-times"></i> ERROU</span>
                    {% endif %}
                </div>

                <div class="q-text" style="font-size: 1.1rem; margin-bottom: 15px;">
                    {{ d.q }}
                </div>

                <div class="hist-options">
                    <div style="margin-bottom: 8px;">
                        <span style="font-size: 0.85rem; color: var(--text-light);">Sua resposta:</span><br>
                        {% if d.chosen >= 0 %}
                            <span style="font-weight: 600; color: {{ 'var(--success)' if d.is_correct else 'var(--error)' }};">
                                {{ d.options[d.chosen] }}
                            </span>
                        {% else %}
                            <span style="font-weight: 600; color: var(--text-light); font-style: italic;">
                                <i class="far fa-clock"></i> Tempo esgotado (Não respondeu)
                            </span>
                        {% endif %}
                    </div>

                    {% if not d.is_correct %}
                        <div style="margin-bottom: 15px;">
                            <span style="font-size: 0.85rem; color: var(--text-light);">Resposta correta:</span><br>
                            <span style="font-weight: 600; color: var(--success);">
                                {{ d.options[d.correct] }}
                            </span>
                        </div>
                    {% endif %}
                </div>

                <div class="feedback-box {{ 'feed-correct' if d.is_correct else 'feed-wrong' }}" style="margin-top: 15px; font-size: 0.95rem;">
                    <strong><i class="fas fa-lightbulb"></i> Explicação:</strong> {{ d.explain }}
                </div>

            </div>
        {% endfor %}
    </div>

</div>

{% endblock %}
